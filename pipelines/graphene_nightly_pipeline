pipeline {
    agent
    {
        node {
                label 'master'
                customWorkspace "${env.JobPath}"
              }
    }
    stages {
        stage ('Parallel invocation of test jobs') {
            parallel {
                stage ('Invoke Ubuntu 22.04 with 6.2 Gramine native Suite') {
                    steps {
                        sleep(time: 15, unit: "MINUTES")
                        build job: 'local_ci_graphene_native_22.04_6.2', parameters: [[$class: 'NodeParameterValue', name: 'node_label', labels: ['graphene'], nodeEligibility: [$class: 'AllNodeEligibility']], [$class: 'StringParameterValue', name: 'gramine_repo', value: gramine_repo], [$class: 'StringParameterValue', name: 'gramine_branch', value: gramine_branch], [$class: 'StringParameterValue', name: 'base_os', value: "ubuntu22.04"], [$class: 'StringParameterValue', name: 'EDMM', value: EDMM]], propagate: true, wait: true
                    }
                }

                stage ('Invoke Ubuntu 22.04 with 6.2 Gramine SGX Suite') {
                    steps {
                        build job: 'local_ci_graphene_sgx_22.04_6.2', parameters: [[$class: 'NodeParameterValue', name: 'node_label', labels: ['graphene_22.04_6.2'], nodeEligibility: [$class: 'AllNodeEligibility']], [$class: 'StringParameterValue', name: 'gramine_repo', value: gramine_repo], [$class: 'StringParameterValue', name: 'gramine_branch', value: gramine_branch], [$class: 'StringParameterValue', name: 'base_os', value: "ubuntu22.04"], [$class: 'StringParameterValue', name: 'EDMM', value: EDMM]], propagate: true, wait: true
                    }
                }

                stage ('Invoke CentOS Stream 10 with 6.12 Gramine Native Suite ') {
                    steps {
                        sleep(time: 30, unit: "MINUTES")
                        build job: 'local_ci_graphene_native_centos_10_6.12', parameters: [[$class: 'NodeParameterValue', name: 'node_label', labels: ['graphene'], nodeEligibility: [$class: 'AllNodeEligibility']], [$class: 'StringParameterValue', name: 'gramine_repo', value: gramine_repo], [$class: 'StringParameterValue', name: 'gramine_branch', value: gramine_branch], [$class: 'StringParameterValue', name: 'base_os', value: "centos10"], [$class: 'StringParameterValue', name: 'EDMM', value: EDMM]], propagate: true, wait: true
                    }
                }

                stage ('Invoke CentOS Stream 10 with 6.12 Gramine SGX Suite ') {
                    steps {
                        sleep(time: 50, unit: "MINUTES")
                        build job: 'local_ci_graphene_sgx_centos_10_6.12', parameters: [[$class: 'NodeParameterValue', name: 'node_label', labels: ['gramine_centos_stream10'], nodeEligibility: [$class: 'AllNodeEligibility']], [$class: 'StringParameterValue', name: 'gramine_repo', value: gramine_repo], [$class: 'StringParameterValue', name: 'gramine_branch', value: gramine_branch], [$class: 'StringParameterValue', name: 'base_os', value: "centos10"], [$class: 'StringParameterValue', name: 'EDMM', value: EDMM]], propagate: true, wait: true
                    }
                }
            }
        }
    }
}
