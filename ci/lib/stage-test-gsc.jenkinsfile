stage('Test Bash') {
    sh '''
        docker run --device=/dev/sgx_enclave \
            -v /var/run/aesmd/aesm.socket:/var/run/aesmd/aesm.socket \
            gsc-bash-test -c free
    '''
}

stage('Test Python') {
    sh '''
        docker run --device=/dev/sgx_enclave \
            -v /var/run/aesmd/aesm.socket:/var/run/aesmd/aesm.socket \
            gsc-python -c 'print("HelloWorld!")'
    '''
}

stage('Test Helloworld') {
    sh '''
        docker run --device=/dev/sgx_enclave \
            -v /var/run/aesmd/aesm.socket:/var/run/aesmd/aesm.socket \
            gsc-helloworld-test
    '''
}

stage('Docker images cleanup') {
    sh '''
        docker stop $(docker ps -aq)
        docker rm $(docker ps -aq)
        docker image prune -af
    '''
}
